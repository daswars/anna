{{/*
  Priority Thumbnail Partial - for above-the-fold LCP images

  Usage:
    {{ partial "thumbnail-priority.html" (dict
      "src" "/images/paintings/2022/painting.jpg"
      "alt" "Artwork title"
      "class" "optional-css-classes"
    ) }}

  Generates an eager-loaded, high-priority WebP thumbnail (400px width)
*/}}

{{- $src := .src -}}
{{- $alt := .alt | default "" -}}
{{- $class := .class | default "" -}}

{{/* Convert /images/ path to assets path */}}
{{- $assetPath := replace $src "/images/" "images/" -}}

{{/* Get the image resource */}}
{{- $image := resources.Get $assetPath -}}

{{- if $image -}}
  {{/* Generate thumbnail (400px width, WebP, q65 for optimal file size) */}}
  {{- $thumb := $image.Resize "400x webp q65" -}}

  {{/* Tiny placeholder for blur-up */}}
  {{- $placeholder := $image.Resize "20x webp q20" -}}

  <img
    src="{{ $thumb.RelPermalink }}"
    alt="{{ $alt }}"
    width="{{ $thumb.Width }}"
    height="{{ $thumb.Height }}"
    loading="eager"
    decoding="async"
    fetchpriority="high"
    {{ with $class }}class="{{ . }}"{{ end }}
    style="background-image: url('data:image/webp;base64,{{ $placeholder.Content | base64Encode }}'); background-size: cover;"
  >
{{- else -}}
  {{/* Fallback if image not found */}}
  <img src="{{ $src }}" alt="{{ $alt }}" {{ with $class }}class="{{ . }}"{{ end }} loading="eager" fetchpriority="high">
{{- end -}}
