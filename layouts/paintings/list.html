{{ define "main" }}
{{/* Paintings Gallery - Design OS PaintingsGallery style with Lightbox */}}
<div class="section-page">
  <main class="section-content section-wide">

    {{/* Page Title with Gallery Navigation */}}
    {{ partial "_page-title.html" (dict
      "title" (i18n "paintings")
      "showGalleryNav" true
      "activeSection" "paintings"
      "context" $
    ) }}

    {{/* Get unique years and sort descending */}}
    {{ $allPaintings := .Site.Data.paintings.paintings }}
    {{ $years := slice }}
    {{ range $allPaintings }}
      {{ $year := .year }}
      {{ if not (in $years $year) }}
        {{ $years = $years | append $year }}
      {{ end }}
    {{ end }}
    {{ $sortedYears := sort $years "value" "desc" }}

    {{/* Gallery Meta - Stats & Separator */}}
    {{ $metaText := printf "%d %s · %d–%d" (len $allPaintings) (i18n "works") (index $sortedYears (sub (len $sortedYears) 1)) (index $sortedYears 0) }}
    {{ partial "_section-separator.html" (dict "text" $metaText) }}

    {{/* Year Sections */}}
    <div class="space-y-24 md:space-y-32">
      {{ $globalIndex := 0 }}
      {{ range $sortedYears }}
        {{ $year := . }}
        <section class="scroll-mt-24">
          {{/* Year Heading - using shared partial */}}
          {{ partial "_year-section.html" (dict "year" $year "size" "medium") }}

          {{/* Artwork Grid */}}
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-x-6 md:gap-x-8 gap-y-12 md:gap-y-16">
            {{ range $idx, $painting := where $allPaintings "year" $year }}
            {{/* Calculate global index for this painting */}}
            {{ $artworkIndex := 0 }}
            {{ range $i, $p := $allPaintings }}
              {{ if eq $p.id $painting.id }}
                {{ $artworkIndex = $i }}
              {{ end }}
            {{ end }}
            {{/* Artwork Card - using shared partial */}}
            {{ partial "_artwork-card.html" (dict
              "artwork" $painting
              "index" $artworkIndex
              "lang" $.Site.Language.Lang
              "context" $
              "type" "button"
              "showDimensions" true
              "priority" (eq $artworkIndex 0)
            ) }}
            {{ end }}
          </div>
        </section>
      {{ end }}
    </div>

    {{/* Gallery Footer */}}
    <footer class="mt-32 pt-8 border-t border-stone-200 dark:border-stone-800">
      <p class="text-sm text-stone-400 dark:text-stone-600 tracking-wider">
        {{ len $allPaintings }} {{ i18n "works" }} · {{ $.Site.Params.portfolio_years }}
      </p>
    </footer>

  </main>
</div>

{{/* Include Lightbox */}}
{{ partial "lightbox.html" . }}

{{/* Initialize Lightbox with artwork data - Hugo generates responsive optimized URLs */}}
<script>
  document.addEventListener('DOMContentLoaded', function() {
    initLightbox([
      {{ range $allPaintings }}
      {{- $assetPath := replace .image "/images/" "images/" -}}
      {{- $img := resources.Get $assetPath -}}
      {{- if $img -}}
      {{- $img800 := $img.Resize "800x webp q80" -}}
      {{- $img1200 := $img.Resize "1200x webp q80" -}}
      {{- $img1400 := $img.Resize "1400x webp q80" -}}
      {
        id: "{{ .id }}",
        title_de: "{{ .title_de }}",
        title_en: "{{ .title_en }}",
        year: {{ .year }},
        medium_de: "{{ .medium_de }}",
        medium_en: "{{ .medium_en }}",
        dimensions: "{{ .dimensions }}",
        image_800: "{{ $img800.RelPermalink }}",
        image_1200: "{{ $img1200.RelPermalink }}",
        image_1600: "{{ $img1400.RelPermalink }}",
        image: "{{ $img1200.RelPermalink }}"
      },
      {{- end -}}
      {{ end }}
    ]);
  });
</script>
{{ end }}
